import{h as b,_ as z}from"./index-djXECPeb.js";import{ag as i,m,p as h,T as a,O as s,q as d,F as y,a7 as D,S as L,M as C}from"./vue-ZDMaqQfr.js";import"./element-k04-Ygsx.js";import"./vxe-4ZPAR52n.js";const Q={name:"LogTable",data(){return{queryHeader:[],queryData:[],displayedQueries:[],currentPage:1,pageSize:25,formData:{timeRange:"Recent 30 min",selectedDatabase:"all",rowLimit:"Limit 50",filterKeyword:""},allDatabases:[]}},created(){this.fetchData()},methods:{fetchData(){const o="http://127.0.0.1:8086/query";let n;this.formData.selectedDatabase==="all"?n="":n=this.formData.selectedDatabase;const _="show queries",f="show databases";b.get(o,{params:{pretty:!0,q:f}}).then(e=>{const t=e.data.results[0];t&&t.series&&(this.allDatabases=t.series[0].values.map(r=>r[0]))}).catch(e=>{console.error("Error fetching databases:",e)}),b.get(o,{params:{db:n,pretty:!0,q:_}}).then(e=>{const t=e.data.results[0];t&&t.series?(this.queryHeader=t.series[0].columns,this.queryData=t.series[0].values.map(r=>t.series[0].columns.reduce((c,u,p)=>(c[u]=r[p],c),{})),this.updateDisplayedQueries()):console.error("No series or empty series in slow queries results.")}).catch(e=>{console.error("Error fetching slow queries:",e)})},handleSelectChange(){this.fetchData()},updateDisplayedQueries(){const o=(this.currentPage-1)*this.pageSize;this.displayedQueries=this.queryData.slice(o,o+this.pageSize)},handleSizeChange(o){this.pageSize=o,this.currentPage=1,this.updateDisplayedQueries()},handleCurrentChange(o){this.currentPage=o,this.updateDisplayedQueries()},executeQuery(){this.fetchData()}}},R={class:"top-container"},x={class:"input-container"},k={class:"input-container"},F={class:"input-container"},B={class:"input-search"},E={class:"query-button"};function P(o,n,_,f,e,t){const r=i("el-option"),c=i("el-select"),u=i("el-form-item"),p=i("el-input"),w=i("el-button"),v=i("el-form"),g=i("el-card"),S=i("el-table-column"),q=i("el-table"),V=i("el-pagination");return m(),h("div",null,[a(g,{shadow:"always",class:"card-wrapper"},{default:s(()=>[a(v,{model:e.formData,ref:"form","label-width":"90px"},{default:s(()=>[d("div",R,[d("div",x,[a(u,null,{default:s(()=>[a(c,{modelValue:e.formData.timeRange,"onUpdate:modelValue":n[0]||(n[0]=l=>e.formData.timeRange=l),onChange:t.handleSelectChange,clearable:"",placeholder:"Time range"},{default:s(()=>[a(r,{label:"Recent 30 min",value:"Recent 30 min"}),a(r,{label:"Recent 1 hour",value:"Recent 1 hour"}),a(r,{label:"Recent 1 week",value:"Recent 1 week"}),a(r,{label:"Recent 1 month",value:"Recent 1 month"})]),_:1},8,["modelValue","onChange"])]),_:1})]),d("div",k,[a(u,null,{default:s(()=>[a(c,{modelValue:e.formData.selectedDatabase,"onUpdate:modelValue":n[1]||(n[1]=l=>e.formData.selectedDatabase=l),onChange:t.handleSelectChange,clearable:"",placeholder:"All databases"},{default:s(()=>[a(r,{label:"All databases",value:"all"}),(m(!0),h(y,null,D(e.allDatabases,l=>(m(),C(r,{label:l,value:l,key:l},null,8,["label","value"]))),128))]),_:1},8,["modelValue","onChange"])]),_:1})]),d("div",F,[a(u,null,{default:s(()=>[a(c,{modelValue:e.formData.rowLimit,"onUpdate:modelValue":n[2]||(n[2]=l=>e.formData.rowLimit=l),onChange:t.handleSelectChange,clearable:"",placeholder:"Limit rows"},{default:s(()=>[a(r,{label:"Limit 50",value:"Limit 50"}),a(r,{label:"Limit 100",value:"Limit 100"}),a(r,{label:"Limit 500",value:"Limit 500"})]),_:1},8,["modelValue","onChange"])]),_:1})]),d("div",B,[a(u,null,{default:s(()=>[a(p,{modelValue:e.formData.filterKeyword,"onUpdate:modelValue":n[3]||(n[3]=l=>e.formData.filterKeyword=l),placeholder:"Filter keyword",clearable:""},null,8,["modelValue"])]),_:1})]),d("div",E,[a(u,null,{default:s(()=>[a(w,{type:"primary",onClick:t.executeQuery},{default:s(()=>[L("查询")]),_:1},8,["onClick"])]),_:1})])])]),_:1},8,["model"])]),_:1}),a(g,{shadow:"always",class:"card-wrapper"},{default:s(()=>[a(q,{data:e.displayedQueries,"header-cell-style":{background:"#FFFFFF",color:"#606266"},onSortChange:t.fetchData,border:"",style:{width:"100%"}},{default:s(()=>[(m(!0),h(y,null,D(e.queryHeader,l=>(m(),C(S,{prop:l,label:l,key:l},null,8,["prop","label"]))),128))]),_:1},8,["data","onSortChange"]),a(V,{onSizeChange:t.handleSizeChange,onCurrentChange:t.handleCurrentChange,"current-page":e.currentPage,"page-sizes":[25,50,100,200],"page-size":e.pageSize,total:e.queryData.length,layout:"sizes, prev, pager, next, jumper",style:{float:"right"}},null,8,["onSizeChange","onCurrentChange","current-page","page-size","total"])]),_:1})])}const H=z(Q,[["render",P],["__scopeId","data-v-cf5f64cf"]]);export{H as default};
